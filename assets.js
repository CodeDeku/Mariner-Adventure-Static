// --- STATIC IMAGE MAPPING ---
		export const sceneImages = {
			// --- PROLOGUE & ACT 1 START ---
			'prologue_storm': 'images/storm.jpg',
			'prologue_abyss': 'images/abyss.jpg',
			'start': 'images/wreckage.jpg',
			'start_medicine_success': 'images/wreckage.jpg',
			'start_medicine_fail': 'images/wreckage.jpg',
			'wreckage_success': 'images/chest.jpg',
			'wreckage_fail': 'images/sand_empty.jpg',

			// --- ACT 1: FOREST & GUARD ---
			'treeline': 'images/forest.jpg',
			'treeline_prepared': 'images/forest.jpg',
			'road_encounter': 'images/guard_road.jpg',
			'trail_success': 'images/smuggler_cove_high.jpg',
			'trail_success_talon': 'images/smuggler_cove_high.jpg',
			'trail_fail': 'images/stumble_guard.jpg',
			'guard_talk': 'images/guard_face.jpg',
			'guard_respect': 'images/guard_salute.jpg',
			'guard_bribe': 'images/guard_bribe.jpg',
			'guard_scared': 'images/guard_scared.jpg',
			'combat_guard': 'images/combat_hammer.jpg',
			'combat_fire_elemental': 'images/fire_elemental.jpg',

			// --- ACT 1: SMUGGLERS & MARKET ---
			'smuggler_meet': 'images/smuggler_standoff.jpg',
			'smuggler_cargo': 'images/smuggler_pay.jpg',
			'smuggler_friend': 'images/smuggler_rum.jpg',
			'smuggler_pay': 'images/smuggler_pay.jpg',
			'market_crossroads': 'images/market.jpg',
			'market_stall': 'images/merchant.jpg',
			'market_sell': 'images/merchant.jpg',
			'buy_rum': 'images/merchant.jpg',
			'buy_potion': 'images/merchant.jpg',
			'buy_rope': 'images/merchant.jpg',
			'buy_torch': 'images/merchant.jpg',
			'sell_cargo': 'images/merchant.jpg',
			'sell_rope': 'images/merchant.jpg',
			'sell_torch': 'images/merchant.jpg',
			'sell_potion': 'images/merchant.jpg',
			'sell_rum': 'images/merchant.jpg',

			// --- ACT 1: LIGHTHOUSE APPROACH ---
			'lighthouse_split': 'images/lighthouse_far.jpg',
			'cliff_climb': 'images/cliff.jpg',
			'climb_fail': 'images/fall_cliff.jpg',
			'dark_caves': 'images/caves.jpg',
			'dark_caves_illuminated': 'images/caves.jpg',
			'dark_fail': 'images/cave_injury.jpg',
			'lighthouse_arrival': 'images/lighthouse_door.jpg',
			'ending_order': 'images/guards_win.jpg',
			'ending_chaos': 'images/smugglers_win.jpg',
			'ending_neutral_check': 'images/lockpick.jpg',
			'ending_neutral_success': 'images/lockpick.jpg',
			'ending_neutral_fail': 'images/lighthouse_door.jpg',

			// --- ACT 1: LIGHTHOUSE HUB ---
			'lighthouse_vigil': 'images/dream.jpg',
			'captain_orders': 'images/lighthouse_vigil.jpg',
			'lighthouse_morning': 'images/lighthouse_morning.jpg',
			'learn_absorb': 'images/lighthouse_morning.jpg',
			'learn_primeval': 'images/lighthouse_morning.jpg',
			'cliffside_overlook': 'images/cliffside_overlook.jpg',
			'overlook_scan_success': 'images/cliffside_overlook.jpg',
			'overlook_scan_fail': 'images/cliffside_overlook.jpg',
			'overlook_hasten_fail': 'images/cliffside_overlook.jpg',
			'meeting_the_stranger': 'images/cliffside_overlook.jpg',
			'town_descent': 'images/town_descent.jpg',
			'town_square': 'images/town_square.jpg',

			// --- ACT 1: TOWN LOCATIONS ---
			'alchemist_triage': 'images/plague_doctor.jpg',
			'alchemist_secret_stock': 'images/alchemist_secret.jpg',
			'alchemist_sell': 'images/plague_doctor.jpg',
			'sell_locket_alch': 'images/plague_doctor.jpg',
			'buy_fire': 'images/plague_doctor.jpg',
			'buy_water': 'images/plague_doctor.jpg',
			'buy_tincture': 'images/plague_doctor.jpg',
			'buy_salts': 'images/plague_doctor.jpg',
			'buy_powder': 'images/plague_doctor.jpg',
			'sell_potion_alch': 'images/plague_doctor.jpg',
			'sell_mushroom_alch': 'images/plague_doctor.jpg',
			'sell_fire': 'images/plague_doctor.jpg',
			'sell_water': 'images/plague_doctor.jpg',
			'sell_tincture': 'images/plague_doctor.jpg',
			
			'blackwater_tavern': 'images/tavern_dark.jpg',
			'eat_gruel_instant': 'images/tavern_dark.jpg',
			'buy_gruel_to_go': 'images/tavern_dark.jpg',
			'tavern_gambler': 'images/tavern_gambler.jpg',
			'tavern_confiscate_dice': 'images/tavern_gambler.jpg',
			'tavern_payout': 'images/tavern_gambler.jpg',
			'tavern_expose_success': 'images/tavern_gambler.jpg',
			'tavern_expose_fail': 'images/tavern_gambler.jpg',
			'tavern_rest_success': 'images/tavern_dark.jpg',
			
			'town_docks': 'images/docks.jpg',
			'docks_sell_cargo': 'images/docks.jpg',
			'docks_work': 'images/docks_work.jpg',
			'docks_dive_success': 'images/docks_treasure.jpg',
			'docks_dive_fail': 'images/docks_work.jpg',
			'docks_smuggler_success': 'images/docks.jpg',
			'docks_smuggler_fail': 'images/docks.jpg',
			'gather_info_smelter': 'images/tavern_dark.jpg',
			'gather_info_chapel': 'images/tavern_dark.jpg',

			// --- ACT 1: FIRE PATH (Smelter) ---
			'smelter_entry': 'images/steam_pipe.jpg',
			'smelter_side_rope': 'images/smelter_workers.jpg',
			'smelter_safe': 'images/steam_pipe.jpg',
			'smelter_combat_loop': 'images/slag_horror.jpg',
			'smelter_victory_generic': 'images/slag_horror_exposed.jpg',
			'smelter_damage': 'images/steam_pipe.jpg',
			'smelter_workers': 'images/smelter_workers.jpg',
			'smelter_containment_success': 'images/smelter_workers.jpg',
			'smelter_save_workers_success': 'images/smelter_workers.jpg',
			'smelter_save_workers_fail': 'images/smelter_workers.jpg',
			'smelter_stage1_start': 'images/slag_horror.jpg',
			'smelter_stage2_clean': 'images/slag_horror_close.jpg',
			'smelter_stage2_damaged': 'images/slag_horror_close.jpg',
			'smelter_victory_lubricant': 'images/slag_horror_exposed.jpg',
			'smelter_victory_ring': 'images/slag_horror_exposed.jpg',
			'smelter_victory_item': 'images/slag_horror_exposed.jpg',
			'smelter_victory_skill': 'images/slag_horror_exposed.jpg',
			'smelter_victory_brute': 'images/slag_horror_exposed.jpg',

			// --- ACT 1: SHADOW PATH (Chapel) ---
			'chapel_entry': 'images/fog_cemetery.jpg',
			'chapel_side_torch': 'images/chapel_vestry.jpg',
			'chapel_safe': 'images/fog_cemetery.jpg',
			'chapel_combat_loop': 'images/drowned_spectre.jpg',
			'chapel_victory_generic': 'images/drowned_spectre_close.jpg',
			'chapel_damage': 'images/fog_cemetery.jpg',
			'chapel_vestry': 'images/chapel_vestry.jpg',
			'chapel_rescue_success': 'images/chapel_vestry.jpg',
			'chapel_rescue_fail': 'images/chapel_vestry.jpg',
			'chapel_ignore_drowning': 'images/chapel_vestry.jpg',
			'chapel_stage1_reveal': 'images/drowned_spectre.jpg',
			'chapel_stage2_finish': 'images/drowned_spectre_close.jpg',
			'chapel_stage2_hit_damaged': 'images/drowned_spectre_close.jpg',
			'chapel_stage2_miss_damaged': 'images/drowned_spectre_close.jpg',
			'chapel_victory_water': 'images/drowned_spectre_close.jpg',
			'chapel_victory_sword': 'images/drowned_spectre_close.jpg',
			'chapel_victory_item': 'images/drowned_spectre_close.jpg',
			'chapel_victory_skill': 'images/drowned_spectre_close.jpg',
			'chapel_victory_brute': 'images/drowned_spectre_close.jpg',

			// --- ACT 1 FINALE ---
			'rift_collapse_punishment': 'images/rift_collapse_red.jpg',
			'finale_ritual_start': 'images/town_square.jpg',
			'edward_death': 'images/abyss.jpg',

			// --- ACT 2: MANOR ---
			'act2_arrival': 'images/manor_ethereal.jpg',
			'act2_tether_fail': 'images/rift_collapse_red.jpg',
			'manor_foyer': 'images/manor_foyer.jpg',
			'manor_map_view': 'images/manor_blueprint.jpg',
			'manor_library': 'images/manor_library.jpg',
			'library_success': 'images/manor_library.jpg',
			'library_fail': 'images/manor_library.jpg',
			'manor_servants_passage': 'images/manor_library.jpg',
			'manor_crawlspace': 'images/manor_hall.jpg',
			'cub_encounter': 'images/displacer_cub.jpg',
			'cub_tame_success': 'images/displacer_cub.jpg',
			'cub_tame_fail': 'images/displacer_cub.jpg',
			'manor_kitchens': 'images/manor_kitchens.jpg',
			'manor_ballroom_encounter': 'images/manor_ballroom.jpg',
			'manor_ballroom_safe': 'images/manor_ballroom.jpg',
			'gareth_spar_success': 'images/manor_ballroom.jpg',
			'gareth_spar_fail': 'images/manor_ballroom.jpg',
			'beast_blink_distract': 'images/manor_ballroom.jpg',
			'beast_true_sight': 'images/manor_ballroom.jpg',
			'beast_fail': 'images/manor_ballroom.jpg',
			'manor_hall': 'images/manor_hall.jpg',
			'manor_mimic_reveal': 'images/mimic.jpg',
			'manor_mimic_trap': 'images/mimic.jpg',
			'manor_mimic_victory': 'images/manor_hall.jpg',
			'manor_mimic_victory_combat': 'images/manor_hall.jpg',
			'manor_automaton_encounter': 'images/brass_automaton.jpg',
			'automaton_sunder_fail': 'images/brass_automaton.jpg',
			'automaton_blink_bypass': 'images/brass_automaton.jpg',
			'automaton_brute_force': 'images/brass_automaton.jpg',
			'automaton_victory_sword': 'images/brass_automaton.jpg',
			'automaton_disable_success': 'images/brass_automaton.jpg',
			'automaton_disable_fail': 'images/brass_automaton.jpg',
			'manor_staircase': 'images/manor_staircase.jpg',
			'staircase_fail': 'images/manor_staircase.jpg',
			'manor_anchor_door': 'images/manor_staircase.jpg',
			'act2_finale_resolution': 'images/manor_staircase.jpg',
			'manor_forge': 'images/manor_kitchens.jpg',
			'manor_forge_combine': 'images/manor_kitchens.jpg',
			'manor_foyer_safe': 'images/manor_foyer.jpg',
			'manor_library_safe': 'images/manor_library.jpg',
			'library_research_success': 'images/manor_library.jpg',
			'library_research_fail': 'images/manor_library.jpg',
			'manor_crawlspace_safe': 'images/manor_hall.jpg',
			'talon_scavenge_gears': 'images/manor_hall.jpg',
			'talon_scavenge_rare': 'images/manor_hall.jpg',
			'talon_scavenge_food': 'images/manor_hall.jpg',
			'manor_cellar_puzzle': 'images/circuit_puzzle.jpg',
			'manor_cellar_success': 'images/circuit_puzzle.jpg',
			'manor_hall_safe': 'images/manor_hall.jpg',
			'manor_kitchens_safe': 'images/manor_kitchens.jpg',
			'act3_long_rest': 'images/manor_foyer.jpg',
			'wolf_estate_safe': 'images/manor_foyer.jpg',
			'anchor_decision_point': 'images/manor_staircase.jpg',
			
			// --- ACT 3: OPEN SEA ---
			'act3_name_ship': 'images/pirate_ship_at_sea.jpg',
			'act3_intro_ship': 'images/pirate_ship_at_sea.jpg',
			'port_provisioner': 'images/town_docks.jpg',
			'port_provisioner_sell': 'images/town_docks.jpg',
			'sea_map_hub': 'images/map_compass.jpg',
			'sea_feeding_grounds': 'images/feeding_grounds.jpg',
			'feeding_success': 'images/feeding_grounds.jpg',
			'feeding_fail': 'images/feeding_grounds.jpg',
			'sea_flotsam_event': 'images/pirate_ship_at_sea.jpg',
			'flotsam_success': 'images/pirate_ship_at_sea.jpg',
			'flotsam_fail': 'images/pirate_ship_at_sea.jpg',
			'sea_fish_success': 'images/pirate_ship_at_sea.jpg',
			'sea_fish_fail': 'images/pirate_ship_at_sea.jpg',
			'sea_event_fog': 'images/fog_at_sea.jpg',
			'sea_fog_puzzle': 'images/fog_at_sea.jpg',
			'sea_fog_success': 'images/fog_at_sea.jpg',
			'sea_fog_partial': 'images/fog_at_sea.jpg',
			'sea_fog_fail': 'images/fog_at_sea.jpg',
			'sea_navy_encounter': 'images/navy_ship.jpg',
			'sea_navy_clean': 'images/navy_ship.jpg',
			'sea_navy_caught': 'images/navy_ship.jpg',
			'sea_navy_jettison': 'images/navy_ship.jpg',
			'sea_navy_combat': 'images/navy_ship.jpg',
			'sea_sanguine_tithe_event': 'images/navy_ship.jpg',
			'silas_reckoning_logic': 'images/navy_ship.jpg',
			'silas_reckoning_success': 'images/navy_ship.jpg',
			'silas_reckoning_combat': 'images/navy_ship.jpg',
			'tithe_combat': 'images/navy_ship.jpg',
			'tithe_loot_success': 'images/navy_ship.jpg',
			'post_spire_rest': 'images/pirate_ship_at_sea.jpg',
			'citadel_reaction_logic': 'images/iron_citadel.jpg',
			'silas_final_words': 'images/pirate_ship_at_sea.jpg',
			'sea_scavenger_encounter': 'images/pirate_ship_at_sea.jpg',

			// --- ACT 3: LOCATIONS ---
			'bleak_dogtooth': 'images/bleak_coast.jpg',
			'dogtooth_intimidate_success': 'images/bleak_coast.jpg',
			'dogtooth_intimidate_fail': 'images/bleak_coast.jpg',
			'dogtooth_lore_success': 'images/bleak_coast.jpg',
			'dogtooth_lore_fail': 'images/bleak_coast.jpg',
			'dogtooth_cliff_wall': 'images/dogtooth_cliff_wall.jpg',
			'silas_sanctuary': 'images/dogtooth_cliff_wall.jpg',
			'silas_recruit_success': 'images/dogtooth_cliff_wall.jpg',
			'dogtooth_envoy': 'images/bleak_coast.jpg',
			'envoy_mercy_kill': 'images/bleak_coast.jpg',
			'envoy_turn': 'images/bleak_coast.jpg',
			'dogtooth_lab_ruins': 'images/bleak_coast.jpg',
			
			'hub_order': 'images/iron_citadel.jpg',
			'order_quartermaster': 'images/iron_citadel.jpg',
			'barracks_clue_found': 'images/iron_citadel.jpg',
			'barracks_clue_fail': 'images/iron_citadel.jpg',
			'order_petrified_ward': 'images/iron_citadel.jpg',
			'ward_medicine_success': 'images/iron_citadel.jpg',
			'ward_medicine_fail': 'images/iron_citadel.jpg',
			'ward_donate_rum': 'images/iron_citadel.jpg',
			'ward_bloom_event': 'images/coral_hulk.jpg',
			'ward_bloom_combat': 'images/coral_hulk.jpg',
			'ward_bloom_success': 'images/coral_hulk.jpg',
			'ward_bloom_fail': 'images/coral_hulk.jpg',
			'order_quest_fence_start': 'images/iron_citadel.jpg',
			'order_quest_start': 'images/iron_citadel.jpg',
			'coral_hulk_intro': 'images/coral_hulk.jpg',
			'coral_hulk_combat': 'images/coral_hulk.jpg',
			'coral_hulk_victory': 'images/coral_hulk.jpg',
			
			'hub_chaos': 'images/titans_molt.jpg',
			'chaos_market': 'images/titans_molt.jpg',
			'chaos_secret_shop_check': 'images/titans_molt.jpg',
			'chaos_secret_success': 'images/titans_molt.jpg',
			'chaos_secret_fail': 'images/titans_molt.jpg',
			'molt_traitor_confront': 'images/titans_molt.jpg',
			'traitor_execute': 'images/titans_molt.jpg',
			'traitor_mercy': 'images/titans_molt.jpg',
			'traitor_blackmail': 'images/titans_molt.jpg',
			'chaos_fence_confrontation': 'images/titans_molt.jpg',
			'fence_resolution_order': 'images/titans_molt.jpg',
			'fence_resolution_chaos': 'images/titans_molt.jpg',
			'fence_resolution_neutral': 'images/titans_molt.jpg',
			'chaos_quest_start': 'images/titans_molt.jpg',

			'sanguine_spire_entry': 'images/gothic_sea_spire.jpg',
			'sanguine_spire_combat': 'images/gothic_sea_spire.jpg',
			'spire_combat_loop': 'images/gothic_sea_spire.jpg',
			'spire_victory': 'images/gothic_sea_spire.jpg',
			
			'ending_champion': 'images/abyss.jpg',
			'ending_protector': 'images/lighthouse_morning.jpg',

			// Default Fallback
			'default': 'https://placehold.co/600x400/0f172a/1e293b?text=The+Void'
		};
		
		export const itemRegistry = {
            // PROLOGUE / START WRECKAGE
            "Captain's Tricorn": { name: "Captain's Tricorn", type: 'key', icon: 'fa-hat-cowboy', color: 'text-blue-500', desc: "Passive: A symbol of authority. +1 to Intimidation checks." },
			"Compass": { name: "Compass", type: 'key', icon: 'fa-compass', color: 'text-indigo-400', desc: "Passive: Violently hums near planar energy." },
            "Rusted Cutlass": { name: "Rusted Cutlass", type: 'key', icon: 'fa-khanda', color: 'text-gray-400', desc: "Passive: Reduces damage taken in combat events." },
            "Ship's Log": { name: "Ship's Log", type: 'key', icon: 'fa-book-open', color: 'text-amber-700', desc: "Key Item: Records of the damned. Unlocks your history." },
			// --- NEW COMBAT SKILLS & UTILITIES ---
			"Blade Enhancement": {
				name: "Blade Enhancement",
				type: 'utility',
				icon: 'fa-sword',
				color: 'text-indigo-400',
				desc: "Free Action. Infuses the Sword of Valor, priming for a powerful combo. Lasts until the next attack.",
				btnText: "BLADE ENHANCE",
				action: (state) => {
					state.combat.blade_enhanced_active = true;
					return `Edward focuses planar energy into the Sword of Valor. Combo ready.`;
				}
			},
			"Blink": {
				name: "Blink",
				type: 'utility',
				icon: 'fa-ghost',
				color: 'text-cyan-400',
				desc: "Free Action. Teleports Edward, granting a guaranteed Critical Hit on his next attack.",
				btnText: "BLINK",
				action: (state) => {
					state.combat.blink_used_this_turn = true;
					return `Edward briefly steps through the planar veil, readying a devastating blow.`;
				}
			},
			"Hunter's Mark": {
				name: "Hunter's Mark",
				type: 'utility',
				icon: 'fa-eye',
				color: 'text-green-500',
				desc: "Free Action (Primeval Awareness Skill). Finds a vital spot, applying Vulnerable to the foe.",
				btnText: "HUNTER'S MARK",
				action: (state) => {
					state.combat.hunters_mark_used_this_turn = true;
					return `Edward locates a critical weakness on the ${state.combat.enemy ? state.combat.enemy.name : 'enemy'}.`;
				}
			},
            
            // ACT 1: ROADSIDE / SMUGGLERS / MARKET
            "Curious Cargo": {
                name: "Curious Cargo",
                type: 'key',
                icon: 'fa-box-open', 
                color: 'text-yellow-600',
                desc: "Passive: A heavy crate of mysterious goods.",
				isContraband: true,
                btnText: "SELL",
                action: (state) => {
                    return "Must be sold at the Market or traded at the Cove.";
                }
            },
            "Rum": {
				name: "Rum",
				type: 'consumable',
				icon: 'fa-wine-bottle',
				color: 'text-amber-500',
				btnText: "DRINK",
				desc: "Consumable: Potent grog. Restores 5 HP. Cannot repair Spectral HP.",
				action: (state) => {
					if (state.currentHP >= state.maxHP) {
						return "Your natural vitality is full. The burning grog offers no comfort to the Spectral Shield.";
					}

					// BOON LOGIC: Triage Protocol
					let healAmount = 5;
					if (state.activeBoons.includes('triage')) healAmount += 2;

					const oldHP = state.currentHP;
					state.currentHP = Math.min(state.maxHP, state.currentHP + healAmount);

					const idx = state.inventory.indexOf("Rum");
					if (idx > -1) state.inventory.splice(idx, 1);
					
					const boonText = state.activeBoons.includes('triage') ? " (Triage +2)" : "";
					return `Drank Rum. Healed ${state.currentHP - oldHP} HP${boonText}.`;
				}
			},
            "Healing Potion": {
				name: "Healing Potion",
				type: 'consumable',
				icon: 'fa-flask',
				color: 'text-red-500',
				btnText: "DRINK",
				desc: "Consumable: Alchemical vitality. Restores 10 HP. Cannot repair Spectral HP.",
				action: (state) => {
					if (state.currentHP >= state.maxHP) return "Your health is full.";
					
					// BOON LOGIC
					let healAmount = 10;
					if (state.activeBoons.includes('triage')) healAmount += 2;

					const oldHP = state.currentHP;
					state.currentHP = Math.min(state.maxHP, state.currentHP + healAmount);
					
					const idx = state.inventory.indexOf("Healing Potion");
					if (idx > -1) state.inventory.splice(idx, 1);
					
					// Add boon text to log if active
					const boonText = state.activeBoons.includes('triage') ? " (Triage +2)" : "";
					return `Drank Potion. Healed ${state.currentHP - oldHP} HP${boonText}.`;
				}
			},
            "Rope": { name: "Rope", type: 'key', icon: 'fa-chain', color: 'text-yellow-700', desc: "Passive: Essential for climbing cliffs." },
            "Torch": { name: "Torch", type: 'key', icon: 'fa-fire', color: 'text-orange-500', desc: "Passive: Illuminates dark caves." },
            
            // ACT 1: LIGHTHOUSE FINAL PATH
            "Pearlescent Mushroom": {
				name: "Pearlescent Mushroom",
				type: 'consumable',
				icon: 'fa-cloud-meatball',
				color: 'text-purple-400',
				btnText: "EAT",
				desc: "Consumable: Grants a free use of a Crew member's skill on the next check, but makes you drowsy. This effect can be enhanced.",
				action: (state) => {
                    if (state.crewUseFree) {
                        return "The residual clarity remains. You can only benefit from one mushroom at a time.";
                    }

                    if (!state.crewUseFree) {
                        state.crewUseFree = true;
                        const idx = state.inventory.indexOf("Pearlescent Mushroom");
                        if (idx > -1) state.inventory.splice(idx, 1);
                        return `Consumed Pearlescent Mushroom. Clarity gained! (Free Guiding Voice available)`;
                    }
                    state.inventory.splice(state.inventory.indexOf("Pearlescent Mushroom"), 1);
					state.crewUseFree = true;
					return "A soft purple light suffuses your mind. Your next Crew use will be free of charge (but only one).";
				}
            },
            
            // ACT 1: HUB ACQUISITIONS
            "Salt-Warped Spyglass": { 
                name: "Salt-Warped Spyglass",
                type: 'key', 
                icon: 'fa-eye',
                color: 'text-cyan-400', 
                desc: "Key: A heavy brass instrument. The lens seems to shift focus on its own." 
            },
            "Silver Locket": {
                name: "Silver Locket",
                type: 'key',
                icon: 'fa-heart',
                color: 'text-gray-300',
                btnText: "SELL",
                desc: "Passive: A sentimental item. Might be worth something."
            },
            "Gruel": {
				name: "Gruel",
				type: 'consumable',
				icon: 'fa-bowl-food',
				color: 'text-gray-400',
				btnText: "EAT",
				desc: "Consumable: Cheap, watery sustenance. Restores 2 HP. Cannot repair Spectral HP.",
				action: (state) => {
					if (state.currentHP >= state.maxHP) {
						return "You are full. The watery gruel offers no comfort to the Spectral Shield.";
					}

					const healAmount = 2;
					const oldHP = state.currentHP;
					
					state.currentHP = Math.min(state.maxHP, state.currentHP + healAmount);
					
					const idx = state.inventory.indexOf("Gruel");
					if (idx > -1) state.inventory.splice(idx, 1);
					
					return `Ate Gruel. Healed ${state.currentHP - oldHP} HP.`;
				}
			},
            "Dead Man's Die": {
                name: "Dead Man's Die",
                type: 'consumable',
                icon: 'fa-dice-six', 
                color: 'text-gray-200',
                btnText: "INSPECT",
                desc: "Consumable: A bone die loaded to cheat fate. Allows you to escape a failure outcome once."
            },
            "Strange Coin": { name: "Strange Coin", type: 'key', icon: 'fa-circle-notch', color: 'text-yellow-600', desc: "Passive: Ancient currency. May open doors not made of wood." },
            
            // ACT 1: ALCHEMIST STOCK
            "Vitality Tincture": { 
				name: "Vitality Tincture",
				type: 'consumable',
				icon: 'fa-syringe', 
				color: 'text-red-300',
				btnText: "DRINK",
				desc: "Consumable: High-grade restorative. Restores 15 HP. Cannot repair Spectral HP.",
				action: (state) => {
					if (state.currentHP >= state.maxHP) {
						return "Your natural vitality is full. Tinctures cannot repair the Spectral Shield.";
					}

					// BOON LOGIC: Triage Protocol
					let healAmount = 15;
					if (state.activeBoons.includes('triage')) healAmount += 2;

					const oldHP = state.currentHP;
					state.currentHP = Math.min(state.maxHP, state.currentHP + healAmount);
					
					const idx = state.inventory.indexOf("Vitality Tincture");
					if (idx > -1) state.inventory.splice(idx, 1);
					
					const boonText = state.activeBoons.includes('triage') ? " (Triage +2)" : "";
					return `Drank Tincture. Healed ${state.currentHP - oldHP} HP${boonText}.`;
				}
			},
            "Smelling Salts": { 
                name: "Smelling Salts",
                type: 'consumable',
                icon: 'fa-spray-can', 
                color: 'text-purple-400',
                btnText: "USE",
                desc: "Consumable: Revives a single used Crew Member (except the last one used).",
                action: (state) => {
                    const usedCrew = Object.values(state.crew).filter(c => c.used);
                    if (usedCrew.length === 0) {
                        return "No crew members are currently exhausted.";
                    }
                    
                    const revivableCrew = usedCrew.filter(c => c.id !== state.lastCrewUsedId);

                    if (revivableCrew.length === 0) {
                        return `Cannot revive ${state.lastCrewUsedId.charAt(0).toUpperCase() + state.lastCrewUsedId.slice(1)}: they were last used for a check.`;
                    }
                    
                    const crewToRevive = revivableCrew[0];
                    state.crew[crewToRevive.id].used = false;
                    
                    const idx = state.inventory.indexOf("Smelling Salts");
                    if (idx > -1) state.inventory.splice(idx, 1);
                    
                    return `Used Salts. ${crewToRevive.name} is now available.`;
                }
            },
            "Flash Powder": { 
                name: "Flash Powder",
                type: 'consumable',
                icon: 'fa-bomb', 
                color: 'text-yellow-300',
                btnText: "THROW",
                desc: "Consumable: Guarantees escape from current combat (if in combat)."
            },
            
            // ACT 1: BOSS COUNTERS & FINALE ARTIFACTS
            "Industrial Lubricant": {
                name: "Industrial Lubricant",
                type: 'consumable',
                icon: 'fa-oil-can',
                color: 'text-gray-400',
                btnText: "USE",
                desc: "Counter: Oily solvent. Critical for Slag Horror (Fire Path)."
            },
            "Holy Water": { 
				name: "Holy Water", 
				type: 'consumable', 
				icon: 'fa-cross', 
				color: 'text-blue-200', 
				btnText: "COMBINE",
				desc: "A sealed flask of consecrated water. Too precious to drink, but potent against the wicked."
            },
            "Alchemical Fire": { 
                name: "Alchemical Fire",
                type: 'consumable',
                icon: 'fa-fire', 
                color: 'text-orange-600',
                btnText: "IGNITE",
                desc: "Counter: Volatile mixture. Critical for Drowned Spectre (Shadow Path).",
				isCombinable: true
            },
            "Phoenix Draft": {
                name: "Phoenix Draft",
                type: 'key',
                icon: 'fa-feather',
                color: 'text-red-400',
                btnText: "PASSIVE",
                desc: "Key Item: Alchemical reserve. Automatically prevents death once, healing 10 HP. Consumed on use."
            },
            "Sword of Valor": { 
				name: "Sword of Valor", 
				type: 'weapon', 
				icon: 'fa-star', 
				color: 'text-yellow-400', 
				desc: "A gleaming cutlass, sharp enough to cut the veil. Deals 1d8+1 Magic Damage.",
				damage: '1d8+1',
				isCombinable: true
				
            },
            "Ring of Brass": { 
                name: "Ring of Brass",
                type: 'key', 
                icon: 'fa-ring', 
                color: 'text-amber-500', 
                desc: "Legendary (Wolves of Valor): Doubles Primeval Awareness range. Grants Keen Senses (Perception advantage on hidden objects)." 
            },

            // ACT 2: MANOR ITEMS
            "Spectral Lantern": {
				name: "Spectral Lantern",
				type: 'gear',
				icon: 'fa-lightbulb',
				color: 'text-amber-400',
				desc: "A lantern whose light burns cold and does not cast shadows. Grants +1 Defense (AC). Can be used at the Spectral Forge.",
				isCombinable: true,
				onAcquire: (state) => { state.passiveDefenseBonus += 1; }, 
				onRemove: (state) => { state.passiveDefenseBonus -= 1; }  
			},
            "Manor Blueprint": {
                name: "Manor Blueprint",
                type: 'key',
                icon: 'fa-map-signs', 
                color: 'text-cyan-400',
                btnText: "VIEW",
                desc: "Passive: Schematics of the Vanishing Manor. Reveals the current room location via the 'Check Blueprint' action."
            },
			"Mimic's Bile": { 
				name: "Mimic's Bile", 
				type: 'ingredient', 
				icon: 'fa-vial', 
				color: 'text-green-500', 
				desc: "Highly corrosive digestive acid, harvested from a Mimic's core. Deals Acid Damage.",
				isContraband: true,
				isCombinable: true,
                action: (state) => {
                    return "A corrosive ingredient for the Spectral Forge. Do not drink.";
                }
			},
            
            // ACT 2: COMBINED ARTIFACTS
			"Mind-Expanding Grog": {
				name: "Mind-Expanding Grog",
				type: 'consumable',
				icon: 'fa-glass-water',
				color: 'text-purple-300',
				btnText: "DRINK",
				desc: "Consumable: A potent mix of spirits and mushroom extract. Acts as a Long Rest and grants one free Crew use.",
				action: (state) => {
					state.currentHP = state.maxHP;
					Object.values(state.crew).forEach(c => c.used = false);
					state.crewUseFree = true; 
					
					const idx = state.inventory.indexOf("Mind-Expanding Grog");
					if (idx > -1) state.inventory.splice(idx, 1);
					
					return "The grog is surprisingly smooth, followed by a rush of clarity. Your wounds close, your Crew awakens, and your next Guiding Voice is free.";
				}
			},
			"The Warding Ember": {
				name: "The Warding Ember",
				type: 'passive',
				icon: 'fa-gem',
				color: 'text-red-600',
				desc: "The Spectral Lantern fused with Alchemical Fire. It burns with protective intensity, permanently granting +2 Defense (AC).",
				onAcquire: (state) => { state.passiveDefenseBonus += 2; }
			},
			"Acid-Etched Sword of Valor": {
				name: "Acid-Etched Sword of Valor",
				type: 'weapon',
				icon: 'fa-biohazard',
				color: 'text-green-500',
				desc: "The blade is etched with glowing acid, effective against armor. Deals 1d8+1 Magic Damage, and an extra 1d4 Acid Damage (Ignores 1 AC).",
				damage: '1d8+1 + 1d4 (Acid vs Armor)',
				isCombined: true,
			},
			"Radiant-Washed Sword of Valor": {
				name: "Radiant-Washed Sword of Valor",
				type: 'weapon',
				icon: 'fa-sun',
				color: 'text-blue-200',
				desc: "The blade hums with purified light. Deals 1d8+1 Magic Damage, and an extra 1d4 Radiant Damage against Undead.",
				damage: '1d8+1 + 1d4 (Radiant vs Undead)',
				isCombined: true,
			},
			"Ember-Heart": {
				name: "Ember-Heart",
				type: 'key',
				icon: 'fa-fire-burner', 
				color: 'text-orange-500',
				desc: "Quest Item: A molten core. The Order needs it for the Foundry; Rook needs it for the Bio-Reactor.",
				isContraband: true 
			},
			"Nutrient Slurry": {
				name: "Nutrient Slurry",
				type: 'consumable',
				icon: 'fa-jar',
				color: 'text-green-500',
				btnText: "EAT",
				desc: "Consumable: Rendered Hyper-Coral paste. Tastes like ash and ambition. Restores 8 HP.",
				action: (state) => {
					if (state.currentHP >= state.maxHP) return "You are full.";

					const healAmount = 8;
					const oldHP = state.currentHP;
					
					state.currentHP = Math.min(state.maxHP, state.currentHP + healAmount);
					
					const idx = state.inventory.indexOf("Nutrient Slurry");
					if (idx > -1) state.inventory.splice(idx, 1);
					return `Ate Slurry. Healed ${state.currentHP - oldHP} HP.`;
				}
			},
			"Royal Signet Ring": {
				name: "Royal Signet Ring",
				type: 'key',
				icon: 'fa-ring',
				color: 'text-blue-300',
				desc: "A silver ring bearing the crest of the Citadel. Proof of a guard's death.",
				btnText: "SELL",
				action: (state) => "Can be returned to the Citadel for a reward or sold."
			},
			"Volatile Mutagen": {
				name: "Volatile Mutagen",
				type: 'consumable',
				icon: 'fa-syringe',
				color: 'text-purple-500',
				btnText: "INJECT",
				desc: "A glowing syringe of experimental beast blood. Highly unstable. 50% chance to gain +2 Max HP, 50% chance to take massive Poison damage. Can be stabilized at a Forge.",
				isCombinable: true, 
				action: (state) => {
					if (Math.random() > 0.5) {
						state.maxHP += 2;
						state.currentHP += 2;
						const idx = state.inventory.indexOf("Volatile Mutagen");
						if (idx > -1) state.inventory.splice(idx, 1);
						return "Success! The mutagen rewrites your DNA. +2 Max HP.";
					} else {
						// FIX: Use window.applyDamage and window.fxManager
						state.currentHP = window.applyDamage(state.currentHP, 6, 'poison');
						const idx = state.inventory.indexOf("Volatile Mutagen");
						if (idx > -1) state.inventory.splice(idx, 1);
						window.fxManager.flashRed();
						return "Rejection! Your veins burn. Took 6 Poison Damage.";
					}
				}
			},
			"Stabilized Mutagen": {
				name: "Stabilized Mutagen",
				type: 'consumable',
				icon: 'fa-dna',
				color: 'text-emerald-400',
				btnText: "INJECT",
				desc: "Refined beast blood. Safe to use. Permanently increases Max HP by 3.",
				action: (state) => {
					state.maxHP += 3;
					state.currentHP += 3;
					const idx = state.inventory.indexOf("Stabilized Mutagen");
					if (idx > -1) state.inventory.splice(idx, 1);
					return "You inject the serum. You feel stronger, faster. +3 Max HP.";
				}
			},
			"Beast Whistle": {
				name: "Beast Whistle",
				type: 'key',
				icon: 'fa-dog',
				color: 'text-gray-400',
				desc: "A silver whistle used by Vampires to command their experiments. May allow you to bypass feral beasts."
			},
			"Sun-Star Grenade": {
				name: "Sun-Star Grenade",
				type: 'consumable',
				icon: 'fa-bomb',
				color: 'text-orange-400',
				btnText: "THROW",
				desc: "A volatile fusion of Flash Powder and Alchemical Fire. Deals 25 Damage AND Stuns the enemy (skips their next turn).",
				action: (state) => {
					if (!state.isBossCombat) return "Save this for a worthy foe.";
					
					state.enemyHP -= 25;
					// Logic for Stun is handled in resolveCombatRound by checking item name, 
					// but we can simulate it by not triggering enemy turn immediately here if handled manually, 
					// or by adding a specific flag. For now, we deal massive damage.
					// We will update resolveCombatRound to handle this specific item name for the Stun effect.
					return "<b>BOOM!</b> The grenade erupts with the heat of a star! Dealt 25 Damage and blinded the enemy!";
				}
			},
			"Captain's Reserve": {
				name: "Captain's Reserve",
				type: 'consumable',
				icon: 'fa-flask',
				color: 'text-amber-600',
				btnText: "DRINK",
				desc: "Rum distilled with Vitality Tincture. Heals 25 HP and cures all status effects. Tastes like victory.",
				action: (state) => {
					const oldHP = state.currentHP;
					state.currentHP = Math.min(state.maxHP, state.currentHP + 25);
					state.currentHP = Math.min(state.maxHP, state.currentHP); // Cap at max
					
					const idx = state.inventory.indexOf("Captain's Reserve");
					if (idx > -1) state.inventory.splice(idx, 1);
					
					return `Downed the Captain's Reserve. Healed ${state.currentHP - oldHP} HP. You feel invincible.`;
				}
			},
			"Snare Trap": {
				name: "Snare Trap",
				type: 'key',
				icon: 'fa-link',
				color: 'text-gray-400',
				desc: "A Beast Whistle rigged to a heavy Rope loop. Can be used to instantly capture/defeat a Beast enemy without rolling."
			},
			"Feeding Ground Map": {
				name: "Feeding Ground Map",
				type: 'key',
				icon: 'fa-map',
				color: 'text-indigo-400',
				desc: "A waterproof chart marked with the Leviathan's hunting patterns. Unlocks a high-risk loot location."
			},
			"Mirror Shield": {
				name: "Mirror Shield",
				type: 'gear',
				icon: 'fa-shield-alt',
				color: 'text-gray-200',
				desc: "Order Reward: A polished silver tower shield. Passive: -1 Damage taken. Active: Reflects the first attack of a round."
			},
			"Scale-Stake Driver": {
				name: "Scale-Stake Driver",
				type: 'weapon',
				icon: 'fa-crosshairs',
				color: 'text-orange-600',
				desc: "Chaos Reward: A heavy crossbow carved from Leviathan scale. Active: Deals damage and Stuns the enemy."
			},
			"Gilded Sextant": {
				name: "Gilded Sextant",
				type: 'passive',
				icon: 'fa-compass-drafting',
				color: 'text-yellow-400',
				desc: "Passive: An instrument of impossible precision. Reduces Supply cost of all sea travel by 1."
			},
			"Codex of Tides": {
				name: "Codex of Tides",
				type: 'passive',
				icon: 'fa-book-atlas',
				color: 'text-blue-300',
				desc: "Passive: Quinn's research notes. Grants Advantage (roll twice/bonus) on History & Investigation checks."
			},
			"Battle Rhythm": {
				name: "Battle Rhythm",
				type: 'passive',
				icon: 'fa-stopwatch',
				color: 'text-red-500',
				desc: "Status: You have sparred with Gareth. Your next combat attack deals Double Damage. (One use)."
			},
			"Deep-Iron Ingot": {
				name: "Deep-Iron Ingot",
				type: 'ingredient',
				icon: 'fa-cube',
				color: 'text-gray-400',
				desc: "A heavy bar of cold iron dredged from the abyss. Can be forged into a weapon."
			},
			"Deep-Forged Cutlass": {
				name: "Deep-Forged Cutlass",
				type: 'weapon',
				icon: 'fa-khanda',
				color: 'text-indigo-400',
				desc: "A Sword of Valor fused with Deep-Iron. Heavy, brutal, and unbreakable. Deals 1d10+2 Damage.",
				damage: '1d10+2'
			},
			"Brass Gears": {
				name: "Brass Gears",
				type: 'ingredient',
				icon: 'fa-cogs',
				color: 'text-amber-600',
				desc: "High-value scrap scavenged from the Manor walls. Can be sold or crafted.",
				btnText: "SELL",
				action: (state) => "Sell at a Quartermaster for coin, or use at the Forge."
			},
			"Grapple Hook": {
				name: "Grapple Hook",
				type: 'gear',
				icon: 'fa-anchor',
				color: 'text-gray-300',
				desc: "Passive: A climber's best friend. Automatically passes vertical Athletics checks."
			},
			"Skeleton Key": {
				name: "Skeleton Key",
				type: 'key',
				icon: 'fa-key',
				color: 'text-white',
				desc: "Key: A bone key that opens high-security lockboxes in Faction Hubs."
			},			
        };
		// --- NEW EXPORT: STATUS EFFECT DATA ---
		export const STATUS_EFFECTS = {
			vulnerable: {
				name: 'Vulnerable',
				icon: 'fa-skull',
				color: 'text-red-600',
				desc: '+50% damage taken on next hit.'
			},
			prone: {
				name: 'Prone',
				icon: 'fa-user-injured', // fa-face-down isn't standard free, replaced with user-injured
				color: 'text-amber-500',
				desc: 'Cannot act next turn.'
			},
			burn: {
				name: 'Burning',
				icon: 'fa-fire',
				color: 'text-red-500',
				dmg: '1d4',
				desc: 'Takes damage over time.'
			},
			poison: {
				name: 'Poisoned',
				icon: 'fa-flask',
				color: 'text-green-500',
				dmg: '1d4',
				desc: 'Takes damage over time.'
			},
			frozen: {
				name: 'Frozen',
				icon: 'fa-snowflake',
				color: 'text-cyan-300',
				desc: 'Reduced damage next turn.'
			}
		};